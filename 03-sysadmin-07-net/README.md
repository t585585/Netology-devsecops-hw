# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

Q1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

A1. Доступные интерфейсы:
- Windows
````
PS D:\> netsh interface show interface

Состояние адм.  Состояние     Тип              Имя интерфейса
---------------------------------------------------------------------
Разрешен       Подключен      Выделенный       VirtualBox Host-Only Network
Разрешен       Подключен      Выделенный       Ethernet
Разрешен       Отключен       Выделенный       Беспроводная сеть
````
- Linux
````
vagrant@vagrant:~$ ip -br l
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eth0             UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP>
````
Q2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

A2. Для распознавания соседа по сетевому интерфейсу используется протокол `LLDP` – протокол для обмена информацией между соседними устройствами.

- пакет `lldpd`;
- команда `lldpctl`.

Q3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

A3. `VLAN` – виртуальное разделение коммутатора.

- пакет `vlan`;
- команда `vconfig` (устарела), `ip` (из пакета IPRoute2).
- пример конфига:
````
auto eth0.1400
iface eth0.1400 inet static
        address 192.168.1.1
        netmask 255.255.255.0
        vlan_raw_device eth0
````

Q4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

A4. Агрегация интерфейсов в Linux. 

В терминологии Linux объединение сетевых интерфейсов в один называется `bonding`. Этот режим может использоваться для повышения отказоустойчивости и/или пропускной способности сетевого подключения.

- Linux поддерживает несколько режимов агрегации интерфейсов:
  - **0 (balance-rr)** — round-robin распределение пакетов между интерфейсами. Обеспечивает отказоустойчивость и повышение пропускной способности.
  - **1 (active-backup)** — в каждый момент времени работает только один интерфейс, в случае его выхода из строя, mac-адрес назначается второму интерфейсу и трафик переключается на него.
  - **2 (balance-xor)** — обеспечивает балансировку между интерфейсами на основании MAC-адресов отправителя и получателя.
  - **3 (broadcast)** — отправляет пакеты через все интерфейсы одновременно, обеспечивает отказоустойчивость.
  - **4 (802.3ad)** — обеспечивает агрегацию на основании протокола 802.3ad.
  - **5 (balance-tlb)** — в этом режиме входящий трафик приходит только на один «активный» интерфейс, исходящий же распределяется по всем интерфейсам.
  - **6 (balance-alb)** — балансирует исходящий трафик как tlb, а так же входящий IPv4 трафик используя ARP.
- Пример настройки балансировки:

  Настроим агрегацию сетевых интерфейсов eth0 и eth1 в один bond0, используя round-robin алгоритм балансировки пропускной способности.

  - Установим `ifenslave`:
````
root@localhost:~$ apt-get install ifenslave-2.6
````
  - конфиг `/etc/network/interfaces` примерно к такого вида:
````
auto bond0
iface bond0 inet static
        address 192.168.0.2
        netmask 255.255.255.0
        network 192.168.0.0
        broadcast 192.168.0.255
        gateway 192.168.0.1
        up /sbin/ifenslave bond0 eth0 eth1
        down /sbin/ifenslave -d bond0 eth0 eth1
````
  - Создаем файл `/etc/modprobe.d/bonding.conf`:
````
alias bond0 bonding
options bonding mode=0 miimon=100 downdelay=200 updelay=200
````
  - Добавляем модуль bonding в /etc/modules:
````
root@localhost:~$ echo "bonding" >> /etc/modules
````
  - Перезапускаем службу настройки сети:
````
root@localhost:~$ invoke-rc.d networking restart
````
  - Проверяем, что получилось:
````
root@localhost:~$ ifconfig
bond0     Link encap:Ethernet  HWaddr 00:1e:58:99:f2:a0
          inet addr:192.168.0.2  Bcast:192.168.0.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1
          RX packets:6533845 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6583132 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:3584238626 (3.3 GiB)  TX bytes:5339636447 (4.9 GiB)

eth0      Link encap:Ethernet  HWaddr 00:1e:58:99:f2:a0
          UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1
          RX packets:3741006 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3291562 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1893688937 (1.7 GiB)  TX bytes:2677192063 (2.4 GiB)
          Interrupt:21

eth1      Link encap:Ethernet  HWaddr 00:1e:58:99:f2:a0
          UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1
          RX packets:2792839 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3291570 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1690549689 (1.5 GiB)  TX bytes:2662444384 (2.4 GiB)
          Interrupt:28 Base address:0xa000
````

Q5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

A5. Смотрим, считаем:
- В сети с маской /29 - 8 ip адресов, 6 из них можно использовать для хостов.
````
root@vagrant:~# ipcalc 10.10.10.0/29
Address:   10.10.10.0           00001010.00001010.00001010.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet
````
- Подсетей с маской /29 в сети с маской /24 - 32 подсети.
````
root@vagrant:~# ipcalc 10.10.10.0/24 -s 6 6
Address:   10.10.10.0           00001010.00001010.00001010. 00000000
Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
=>
Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
Hosts/Net: 254                   Class A, Private Internet

1. Requested size: 6 hosts
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet

2. Requested size: 6 hosts
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Network:   10.10.10.8/29        00001010.00001010.00001010.00001 000
HostMin:   10.10.10.9           00001010.00001010.00001010.00001 001
HostMax:   10.10.10.14          00001010.00001010.00001010.00001 110
Broadcast: 10.10.10.15          00001010.00001010.00001010.00001 111
Hosts/Net: 6                     Class A, Private Internet
````
Q6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

A6. "Никто кроме нас!" - все адреса заняты, но! Будем использовать следующий диапазон 100.64.0.0/10 (RFC 6598): возьмем сеть 100.64.0.0/26
````
root@vagrant:~# ipcalc 100.64.0.0/26
Address:   100.64.0.0           01100100.01000000.00000000.00 000000
Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
=>
Network:   100.64.0.0/26        01100100.01000000.00000000.00 000000
HostMin:   100.64.0.1           01100100.01000000.00000000.00 000001
HostMax:   100.64.0.62          01100100.01000000.00000000.00 111110
Broadcast: 100.64.0.63          01100100.01000000.00000000.00 111111
Hosts/Net: 62                    Class A
````

Q7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

A7. Вот так:

- Linux:
````
root@vagrant:~# ip neigh
10.0.2.3 dev eth0 lladdr 52:54:00:12:35:03 STALE
10.0.2.2 dev eth0 lladdr 52:54:00:12:35:02 DELAY
root@vagrant:~# ip neigh flush all
root@vagrant:~# ip neigh flush 10.2.2.3
````
  - Windows:
````
PS D:\> arp -a

Интерфейс: 192.168.10.55 --- 0xd
  адрес в Интернете      Физический адрес      Тип
  192.168.10.2          00-30-48-31-03-04     динамический
  192.168.10.3          ac-1f-6b-33-d4-37     динамический
  192.168.10.5          0c-9d-92-86-15-b4     динамический
  ...
PS D:\> arp -d *
PS D:\> arp -d 192.168.10.8
````
